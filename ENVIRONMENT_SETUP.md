# Environment Variables Setup Guide

This guide explains how to set up environment variables for the Inventory SAS application.

## Table of Contents
- [Backend (Django) Setup](#backend-django-setup)
- [Frontend (React/Vite) Setup](#frontend-reactvite-setup)
- [Production Deployment](#production-deployment)
- [Security Best Practices](#security-best-practices)

---

## Backend (Django) Setup

### 1. Create Environment File

Copy the example environment file:
```bash
cp .env.example .env
```

### 2. Configure Required Variables

Edit the `.env` file and set the following variables:

#### **SECRET_KEY** (Required)
Generate a secure secret key:
```bash
python -c 'from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())'
```
Copy the output and set it in your `.env` file:
```
SECRET_KEY=your-generated-secret-key-here
```

#### **DEBUG** (Required)
Set to `True` for development, `False` for production:
```
DEBUG=True
```

#### **ALLOWED_HOSTS** (Required)
Comma-separated list of allowed hosts:
```
# Development
ALLOWED_HOSTS=localhost,127.0.0.1

# Production (example)
ALLOWED_HOSTS=yourdomain.com,.onrender.com
```

#### **CORS_ALLOWED_ORIGINS** (Required)
Comma-separated list of allowed CORS origins:
```
# Development
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000

# Production (example)
CORS_ALLOWED_ORIGINS=https://yourdomain.com,https://yourfrontend.com
```

#### **DATABASE_URL** (Optional for development)
For local development with SQLite, leave empty. For PostgreSQL:
```
DATABASE_URL=postgresql://user:password@localhost:5432/dbname
```

#### **JWT Token Settings** (Optional)
Configure JWT token lifetimes in days:
```
JWT_ACCESS_TOKEN_LIFETIME_DAYS=1
JWT_REFRESH_TOKEN_LIFETIME_DAYS=7
```

#### **Database Pool Settings** (Optional)
Configure database connection pooling:
```
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=5
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=1800
```

#### **Django Superuser** (Optional)
For initial setup:
```
DJANGO_SUPERUSER_USERNAME=admin
DJANGO_SUPERUSER_EMAIL=admin@example.com
DJANGO_SUPERUSER_PASSWORD=changeme123
```

### 3. Example Development Configuration

```env
SECRET_KEY=django-insecure-your-secret-key-here
DEBUG=True
ALLOWED_HOSTS=localhost,127.0.0.1
CORS_ALLOWED_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
DATABASE_URL=
JWT_ACCESS_TOKEN_LIFETIME_DAYS=1
JWT_REFRESH_TOKEN_LIFETIME_DAYS=7
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=5
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=1800
```

---

## Frontend (React/Vite) Setup

### 1. Create Environment File

Navigate to the frontend directory and copy the example:
```bash
cd frontend
cp .env.example .env
```

### 2. Configure Variables

Edit `frontend/.env`:

#### **VITE_API_URL** (Required)
The backend API URL:
```
# Development
VITE_API_URL=http://localhost:8000

# Production
VITE_API_URL=https://your-backend-domain.com
```

#### **VITE_DEV_SERVER_PORT** (Optional)
Development server port (default: 3000):
```
VITE_DEV_SERVER_PORT=3000
```

#### **VITE_PROXY_TARGET** (Optional)
Proxy target for development (should match VITE_API_URL):
```
VITE_PROXY_TARGET=http://localhost:8000
```

### 3. Example Development Configuration

```env
VITE_API_URL=http://localhost:8000
VITE_DEV_SERVER_PORT=3000
VITE_PROXY_TARGET=http://localhost:8000
```

### 4. Example Production Configuration

Create `frontend/.env.production`:
```env
VITE_API_URL=https://your-backend-domain.com
```

---

## Production Deployment

### Render.com Deployment

The `render.yaml` file is pre-configured with environment variables. Update the following in your Render dashboard:

1. **SECRET_KEY**: Auto-generated by Render
2. **ALLOWED_HOSTS**: Set to your domain (e.g., `.onrender.com,yourdomain.com`)
3. **CORS_ALLOWED_ORIGINS**: Set to your frontend URL (e.g., `https://yourfrontend.com`)
4. **DATABASE_URL**: Auto-configured from database service

### Other Platforms

For other platforms (Heroku, AWS, etc.), ensure you set all required environment variables in your platform's configuration:

- SECRET_KEY
- DEBUG=False
- ALLOWED_HOSTS
- CORS_ALLOWED_ORIGINS
- DATABASE_URL
- All optional variables as needed

---

## Security Best Practices

### 1. Never Commit `.env` Files
The `.gitignore` file is configured to exclude all `.env` files. Never commit them to version control.

### 2. Use Strong Secret Keys
Always generate strong, random secret keys for production:
```bash
python -c 'from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())'
```

### 3. Set DEBUG=False in Production
Never run production with `DEBUG=True`. This exposes sensitive information.

### 4. Restrict ALLOWED_HOSTS
Only include domains you control in `ALLOWED_HOSTS`.

### 5. Restrict CORS_ALLOWED_ORIGINS
Only include trusted frontend domains in `CORS_ALLOWED_ORIGINS`.

### 6. Use Environment-Specific Files
- `.env` - Local development (not committed)
- `.env.example` - Template (committed)
- `.env.production` - Production overrides (not committed)

### 7. Rotate Secrets Regularly
Change your SECRET_KEY and other sensitive credentials periodically.

---

## Troubleshooting

### Backend Issues

**Error: "SECRET_KEY environment variable must be set"**
- Solution: Ensure you've created a `.env` file and set the SECRET_KEY variable.

**Error: "DisallowedHost"**
- Solution: Add your domain to the ALLOWED_HOSTS environment variable.

**CORS Errors**
- Solution: Add your frontend URL to CORS_ALLOWED_ORIGINS.

### Frontend Issues

**API calls failing**
- Solution: Verify VITE_API_URL is set correctly and matches your backend URL.

**Environment variables not loading**
- Solution: Restart the Vite dev server after changing `.env` files.
- Note: Vite only loads variables prefixed with `VITE_`.

---

## Quick Start Commands

### Backend
```bash
# Copy environment template
cp .env.example .env

# Edit .env file with your values
nano .env  # or use your preferred editor

# Run migrations
python manage.py migrate

# Create superuser (optional)
python manage.py createsuperuser

# Start development server
python manage.py runserver
```

### Frontend
```bash
# Navigate to frontend
cd frontend

# Copy environment template
cp .env.example .env

# Edit .env file
nano .env

# Install dependencies
npm install

# Start development server
npm run dev
```

---

## Additional Resources

- [Django Settings Documentation](https://docs.djangoproject.com/en/4.2/topics/settings/)
- [Vite Environment Variables](https://vitejs.dev/guide/env-and-mode.html)
- [Django Security Best Practices](https://docs.djangoproject.com/en/4.2/topics/security/)
